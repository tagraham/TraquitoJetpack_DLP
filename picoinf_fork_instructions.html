<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Picoinf Fork Instructions - LOW_POWER_SINGLE_CLOCK</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; }
        h3 { color: #7f8c8d; }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Consolas', monospace;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .step {
            background: #ecf0f1;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
        }
        .step-number {
            background: #3498db;
            color: white;
            padding: 2px 10px;
            border-radius: 3px;
            font-weight: bold;
            margin-right: 10px;
        }
        .prompt-box {
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
            border-radius: 5px;
            border: 2px solid #e74c3c;
            margin: 20px 0;
        }
        .prompt-box h4 {
            color: #e74c3c;
            margin-top: 0;
        }
        .file-path {
            color: #27ae60;
            font-weight: bold;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>

<h1>Picoinf_DLP Fork Instructions</h1>
<p>Add <code>LOW_POWER_SINGLE_CLOCK</code> compile flag for single clock output mode.</p>

<hr>

<h2>Part 1: Fork and Clone Picoinf</h2>

<div class="step">
    <span class="step-number">Step 1</span>
    <strong>Fork picoinf on GitHub</strong>
    <p>Go to: <a href="https://github.com/dmalnati/picoinf" target="_blank">https://github.com/dmalnati/picoinf</a></p>
    <p>Click "Fork" button.</p>
    <ul>
        <li><strong>Repository name:</strong> <code>picoinf_DLP</code></li>
        <li><strong>Description:</strong> Fork of picoinf with LOW_POWER_SINGLE_CLOCK compile flag for single clock output mode. Used with TraquitoJetpack_DLP.</li>
        <li>Check "Copy main branch only"</li>
    </ul>
    <p>This creates <code>tagraham/picoinf_DLP</code></p>
</div>

<div class="step">
    <span class="step-number">Step 2</span>
    <strong>Clone your fork locally</strong>
    <pre>cd ~/Projects/repos/hamRadio
git clone git@github.com:tagraham/picoinf_DLP.git
cd picoinf_DLP</pre>
</div>

<div class="step">
    <span class="step-number">Step 3</span>
    <strong>Create feature branch</strong>
    <pre>git checkout -b feature/low-power-single-clock</pre>
</div>

<hr>

<h2>Part 2: Apply Changes (Claude Prompt)</h2>

<p>Open Claude Code in the picoinf_DLP project directory and give this prompt:</p>

<div class="prompt-box">
    <h4>PROMPT FOR CLAUDE:</h4>
    <pre>Add LOW_POWER_SINGLE_CLOCK compile flag to WSPRMessageTransmitter.h

File: src/WSPR/WSPRMessageTransmitter.h

Changes needed:

1. Add this comment block after the #include statements (after #include "WSPREncoder.h"):

// LOW_POWER_SINGLE_CLOCK: When defined, uses only CLK0 (single output)
// for reduced power consumption at lower solar angles.
// When not defined (default), uses CLK0 + CLK1 with 180-degree phase shift
// for dual clock output.

2. In RadioOn() function, wrap the CLK1 setup code in #ifndef:
   - Find the comment "// Fan out and invert the first clock signal"
   - Add #ifndef LOW_POWER_SINGLE_CLOCK before that comment
   - Add #endif after radio_.output_enable(SI5351_CLK1, 1);

3. In RadioOff() function, wrap the CLK1 disable code in #ifndef:
   - Add #ifndef LOW_POWER_SINGLE_CLOCK before radio_.output_enable(SI5351_CLK1, 0);
   - Add #endif after radio_.set_clock_pwr(SI5351_CLK1, 0);

4. In SetDrive() function, wrap the CLK1 line in #ifndef:
   - Add #ifndef LOW_POWER_SINGLE_CLOCK before radio_.drive_strength(SI5351_CLK1, pwr);
   - Add #endif after that line

Default behavior (flag not defined) = dual clock output (original behavior).
When LOW_POWER_SINGLE_CLOCK is defined = single clock output only.

Commit message: "Add LOW_POWER_SINGLE_CLOCK compile flag for single clock output mode"</pre>
</div>

<hr>

<h2>Part 3: Push and Create PR</h2>

<div class="step">
    <span class="step-number">Step 4</span>
    <strong>Push branch to your fork</strong>
    <pre>git push -u origin feature/low-power-single-clock</pre>
</div>

<div class="step">
    <span class="step-number">Step 5</span>
    <strong>Merge to main (after verifying changes look correct)</strong>
    <pre>git checkout main
git merge feature/low-power-single-clock
git push</pre>
</div>

<hr>

<h2>Part 4: Update TraquitoJetpack_DLP Submodule</h2>

<div class="step">
    <span class="step-number">Step 6</span>
    <strong>Update submodule to point to your picoinf_DLP fork</strong>
    <pre>cd ~/Projects/repos/hamRadio/TraquitoJetpack
git submodule set-url ext/picoinf git@github.com:tagraham/picoinf_DLP.git
cd ext/picoinf
git fetch origin
git checkout main
cd ../..
git add ext/picoinf .gitmodules
git commit -m "Update picoinf submodule to picoinf_DLP fork with LOW_POWER_SINGLE_CLOCK support"</pre>
</div>

<div class="step">
    <span class="step-number">Step 7</span>
    <strong>Remove sed patch from build.sh</strong>
    <p>Delete the entire "Patching WSPRMessageTransmitter.h" section from build.sh (the sed commands are no longer needed since the changes are now in the fork)</p>
</div>

<div class="step">
    <span class="step-number">Step 8</span>
    <strong>Test both build modes</strong>
    <pre># Rebuild Docker image to pick up submodule changes
docker build -t traquito-build .

# Standard build (dual clock)
docker run --rm -v "$(pwd):/project" traquito-build

# Low power build (single clock)
LOW_POWER_MODE=1 docker run --rm -v "$(pwd):/project" traquito-build</pre>
</div>

<div class="step">
    <span class="step-number">Step 9</span>
    <strong>Update README and commit</strong>
    <p>Remove the "TODO: Fork picoinf submodule" section since it's done.</p>
    <pre>git add README.md build.sh
git commit -m "Remove sed patches, now using picoinf_DLP fork with native LOW_POWER_SINGLE_CLOCK support"
git push</pre>
</div>

<hr>

<h2>Reference: Expected Changes in WSPRMessageTransmitter.h</h2>

<h3>After includes, add comment:</h3>
<pre>// LOW_POWER_SINGLE_CLOCK: When defined, uses only CLK0 (single output)
// for reduced power consumption at lower solar angles.
// When not defined (default), uses CLK0 + CLK1 with 180-degree phase shift
// for dual clock output.</pre>

<h3>RadioOn() - wrap lines ~88-94:</h3>
<pre>#ifndef LOW_POWER_SINGLE_CLOCK
        // Fan out and invert the first clock signal for a
        // 180-degree phase shift on second clock
        radio_.set_clock_fanout(SI5351_FANOUT_MS, 1);
        radio_.set_clock_source(SI5351_CLK1, SI5351_CLK_SRC_MS0);
        radio_.set_clock_invert(SI5351_CLK1, 1);

        radio_.drive_strength(SI5351_CLK1, SI5351_DRIVE_8MA);
        radio_.set_clock_pwr(SI5351_CLK1, 1);
        radio_.output_enable(SI5351_CLK1, 1);
#endif</pre>

<h3>RadioOff() - wrap lines ~164-165:</h3>
<pre>#ifndef LOW_POWER_SINGLE_CLOCK
        radio_.output_enable(SI5351_CLK1, 0);
        radio_.set_clock_pwr(SI5351_CLK1, 0);
#endif</pre>

<h3>SetDrive() - wrap line ~176:</h3>
<pre>    void SetDrive(si5351_drive pwr)
    {
        radio_.drive_strength(SI5351_CLK0, pwr);
#ifndef LOW_POWER_SINGLE_CLOCK
        radio_.drive_strength(SI5351_CLK1, pwr);
#endif
    }</pre>

<hr>

<p><em>Created: January 2026</em></p>

</body>
</html>
